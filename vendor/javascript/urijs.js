// urijs@1.19.11 downloaded from https://ga.jspm.io/npm:urijs@1.19.11/src/URI.js

import e from"./punycode.js";import t from"./IPv6.js";import r from"./SecondLevelDomains.js";var a="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var s={};(function(a,n){s?s=n(e,t,r):a.URI=n(a.punycode,a.IPv6,a.SecondLevelDomains,a)})(s,(function(e,t,r,s){var n=s&&s.URI;function URI(e,t){var r=arguments.length>=1;var s=arguments.length>=2;if(!((this||a)instanceof URI))return r?s?new URI(e,t):new URI(e):new URI;if(void 0===e){if(r)throw new TypeError("undefined is not a valid argument for URI");e="undefined"!==typeof location?location.href+"":""}if(null===e&&r)throw new TypeError("null is not a valid argument for URI");this.href(e);return void 0!==t?this.absoluteTo(t):this||a}function isInteger(e){return/^[0-9]+$/.test(e)}URI.version="1.19.11";var i=URI.prototype;var o=Object.prototype.hasOwnProperty;function escapeRegEx(e){return e.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function getType(e){return void 0===e?"Undefined":String(Object.prototype.toString.call(e)).slice(8,-1)}function isArray(e){return"Array"===getType(e)}function filterArrayValues(e,t){var r={};var a,s;if("RegExp"===getType(t))r=null;else if(isArray(t))for(a=0,s=t.length;a<s;a++)r[t[a]]=true;else r[t]=true;for(a=0,s=e.length;a<s;a++){var n=r&&void 0!==r[e[a]]||!r&&t.test(e[a]);if(n){e.splice(a,1);s--;a--}}return e}function arrayContains(e,t){var r,a;if(isArray(t)){for(r=0,a=t.length;r<a;r++)if(!arrayContains(e,t[r]))return false;return true}var s=getType(t);for(r=0,a=e.length;r<a;r++)if("RegExp"===s){if("string"===typeof e[r]&&e[r].match(t))return true}else if(e[r]===t)return true;return false}function arraysEqual(e,t){if(!isArray(e)||!isArray(t))return false;if(e.length!==t.length)return false;e.sort();t.sort();for(var r=0,a=e.length;r<a;r++)if(e[r]!==t[r])return false;return true}function trimSlashes(e){var t=/^\/+|\/+$/g;return e.replace(t,"")}URI._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,preventInvalidHostname:URI.preventInvalidHostname,duplicateQueryParameters:URI.duplicateQueryParameters,escapeQuerySpace:URI.escapeQuerySpace}};URI.preventInvalidHostname=false;URI.duplicateQueryParameters=false;URI.escapeQuerySpace=true;URI.protocol_expression=/^[a-z][a-z0-9.+-]*$/i;URI.idn_expression=/[^a-z0-9\._-]/i;URI.punycode_expression=/(xn--)/i;URI.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/;URI.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/;URI.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/gi;URI.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?«»“”„‘’]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g};URI.leading_whitespace_expression=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/;URI.ascii_tab_whitespace=/[\u0009\u000A\u000D]+/g;URI.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"};URI.hostProtocols=["http","https"];URI.invalid_hostname_characters=/[^a-zA-Z0-9\.\-:_]/;URI.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"};URI.getDomAttribute=function(e){if(e&&e.nodeName){var t=e.nodeName.toLowerCase();if("input"!==t||"image"===e.type)return URI.domAttributes[t]}};function escapeForDumbFirefox36(e){return escape(e)}function strictEncodeURIComponent(e){return encodeURIComponent(e).replace(/[!'()*]/g,escapeForDumbFirefox36).replace(/\*/g,"%2A")}URI.encode=strictEncodeURIComponent;URI.decode=decodeURIComponent;URI.iso8859=function(){URI.encode=escape;URI.decode=unescape};URI.unicode=function(){URI.encode=strictEncodeURIComponent;URI.decode=decodeURIComponent};URI.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/gi,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/gi,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/gi,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}};URI.encodeQuery=function(e,t){var r=URI.encode(e+"");void 0===t&&(t=URI.escapeQuerySpace);return t?r.replace(/%20/g,"+"):r};URI.decodeQuery=function(e,t){e+="";void 0===t&&(t=URI.escapeQuerySpace);try{return URI.decode(t?e.replace(/\+/g,"%20"):e)}catch(t){return e}};var u={encode:"encode",decode:"decode"};var h;var generateAccessor=function(e,t){return function(r){try{return URI[t](r+"").replace(URI.characters[e][t].expression,(function(r){return URI.characters[e][t].map[r]}))}catch(e){return r}}};for(h in u){URI[h+"PathSegment"]=generateAccessor("pathname",u[h]);URI[h+"UrnPathSegment"]=generateAccessor("urnpath",u[h])}var generateSegmentedPathFunction=function(e,t,r){return function(a){var s;s=r?function(e){return URI[t](URI[r](e))}:URI[t];var n=(a+"").split(e);for(var i=0,o=n.length;i<o;i++)n[i]=s(n[i]);return n.join(e)}};URI.decodePath=generateSegmentedPathFunction("/","decodePathSegment");URI.decodeUrnPath=generateSegmentedPathFunction(":","decodeUrnPathSegment");URI.recodePath=generateSegmentedPathFunction("/","encodePathSegment","decode");URI.recodeUrnPath=generateSegmentedPathFunction(":","encodeUrnPathSegment","decode");URI.encodeReserved=generateAccessor("reserved","encode");URI.parse=function(e,t){var r;t||(t={preventInvalidHostname:URI.preventInvalidHostname});e=e.replace(URI.leading_whitespace_expression,"");e=e.replace(URI.ascii_tab_whitespace,"");r=e.indexOf("#");if(r>-1){t.fragment=e.substring(r+1)||null;e=e.substring(0,r)}r=e.indexOf("?");if(r>-1){t.query=e.substring(r+1)||null;e=e.substring(0,r)}e=e.replace(/^(https?|ftp|wss?)?:+[/\\]*/i,"$1://");e=e.replace(/^[/\\]{2,}/i,"//");if("//"===e.substring(0,2)){t.protocol=null;e=e.substring(2);e=URI.parseAuthority(e,t)}else{r=e.indexOf(":");if(r>-1){t.protocol=e.substring(0,r)||null;if(t.protocol&&!t.protocol.match(URI.protocol_expression))t.protocol=void 0;else if("//"===e.substring(r+1,r+3).replace(/\\/g,"/")){e=e.substring(r+3);e=URI.parseAuthority(e,t)}else{e=e.substring(r+1);t.urn=true}}}t.path=e;return t};URI.parseHost=function(e,t){e||(e="");e=e.replace(/\\/g,"/");var r=e.indexOf("/");var a;var s;-1===r&&(r=e.length);if("["===e.charAt(0)){a=e.indexOf("]");t.hostname=e.substring(1,a)||null;t.port=e.substring(a+2,r)||null;"/"===t.port&&(t.port=null)}else{var n=e.indexOf(":");var i=e.indexOf("/");var o=e.indexOf(":",n+1);if(-1!==o&&(-1===i||o<i)){t.hostname=e.substring(0,r)||null;t.port=null}else{s=e.substring(0,r).split(":");t.hostname=s[0]||null;t.port=s[1]||null}}if(t.hostname&&"/"!==e.substring(r).charAt(0)){r++;e="/"+e}t.preventInvalidHostname&&URI.ensureValidHostname(t.hostname,t.protocol);t.port&&URI.ensureValidPort(t.port);return e.substring(r)||"/"};URI.parseAuthority=function(e,t){e=URI.parseUserinfo(e,t);return URI.parseHost(e,t)};URI.parseUserinfo=function(e,t){var r=e;var a=e.indexOf("\\");-1!==a&&(e=e.replace(/\\/g,"/"));var s=e.indexOf("/");var n=e.lastIndexOf("@",s>-1?s:e.length-1);var i;if(n>-1&&(-1===s||n<s)){i=e.substring(0,n).split(":");t.username=i[0]?URI.decode(i[0]):null;i.shift();t.password=i[0]?URI.decode(i.join(":")):null;e=r.substring(n+1)}else{t.username=null;t.password=null}return e};URI.parseQuery=function(e,t){if(!e)return{};e=e.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,"");if(!e)return{};var r={};var a=e.split("&");var s=a.length;var n,i,u;for(var h=0;h<s;h++){n=a[h].split("=");i=URI.decodeQuery(n.shift(),t);u=n.length?URI.decodeQuery(n.join("="),t):null;if("__proto__"!==i)if(o.call(r,i)){"string"!==typeof r[i]&&null!==r[i]||(r[i]=[r[i]]);r[i].push(u)}else r[i]=u}return r};URI.build=function(e){var t="";var r=false;e.protocol&&(t+=e.protocol+":");if(!e.urn&&(t||e.hostname)){t+="//";r=true}t+=URI.buildAuthority(e)||"";if("string"===typeof e.path){"/"!==e.path.charAt(0)&&r&&(t+="/");t+=e.path}"string"===typeof e.query&&e.query&&(t+="?"+e.query);"string"===typeof e.fragment&&e.fragment&&(t+="#"+e.fragment);return t};URI.buildHost=function(e){var t="";if(!e.hostname)return"";URI.ip6_expression.test(e.hostname)?t+="["+e.hostname+"]":t+=e.hostname;e.port&&(t+=":"+e.port);return t};URI.buildAuthority=function(e){return URI.buildUserinfo(e)+URI.buildHost(e)};URI.buildUserinfo=function(e){var t="";e.username&&(t+=URI.encode(e.username));e.password&&(t+=":"+URI.encode(e.password));t&&(t+="@");return t};URI.buildQuery=function(e,t,r){var a="";var s,n,i,u;for(n in e)if("__proto__"!==n&&o.call(e,n))if(isArray(e[n])){s={};for(i=0,u=e[n].length;i<u;i++)if(void 0!==e[n][i]&&void 0===s[e[n][i]+""]){a+="&"+URI.buildQueryParameter(n,e[n][i],r);true!==t&&(s[e[n][i]+""]=true)}}else void 0!==e[n]&&(a+="&"+URI.buildQueryParameter(n,e[n],r));return a.substring(1)};URI.buildQueryParameter=function(e,t,r){return URI.encodeQuery(e,r)+(null!==t?"="+URI.encodeQuery(t,r):"")};URI.addQuery=function(e,t,r){if("object"===typeof t)for(var a in t)o.call(t,a)&&URI.addQuery(e,a,t[a]);else{if("string"!==typeof t)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");if(void 0===e[t]){e[t]=r;return}"string"===typeof e[t]&&(e[t]=[e[t]]);isArray(r)||(r=[r]);e[t]=(e[t]||[]).concat(r)}};URI.setQuery=function(e,t,r){if("object"===typeof t)for(var a in t)o.call(t,a)&&URI.setQuery(e,a,t[a]);else{if("string"!==typeof t)throw new TypeError("URI.setQuery() accepts an object, string as the name parameter");e[t]=void 0===r?null:r}};URI.removeQuery=function(e,t,r){var a,s,n;if(isArray(t))for(a=0,s=t.length;a<s;a++)e[t[a]]=void 0;else if("RegExp"===getType(t))for(n in e)t.test(n)&&(e[n]=void 0);else if("object"===typeof t)for(n in t)o.call(t,n)&&URI.removeQuery(e,n,t[n]);else{if("string"!==typeof t)throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter");void 0!==r?"RegExp"===getType(r)?!isArray(e[t])&&r.test(e[t])?e[t]=void 0:e[t]=filterArrayValues(e[t],r):e[t]!==String(r)||isArray(r)&&1!==r.length?isArray(e[t])&&(e[t]=filterArrayValues(e[t],r)):e[t]=void 0:e[t]=void 0}};URI.hasQuery=function(e,t,r,a){switch(getType(t)){case"String":break;case"RegExp":for(var s in e)if(o.call(e,s)&&t.test(s)&&(void 0===r||URI.hasQuery(e,s,r)))return true;return false;case"Object":for(var n in t)if(o.call(t,n)&&!URI.hasQuery(e,n,t[n]))return false;return true;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(getType(r)){case"Undefined":return t in e;case"Boolean":var i=Boolean(isArray(e[t])?e[t].length:e[t]);return r===i;case"Function":return!!r(e[t],t,e);case"Array":if(!isArray(e[t]))return false;var u=a?arrayContains:arraysEqual;return u(e[t],r);case"RegExp":return isArray(e[t])?!!a&&arrayContains(e[t],r):Boolean(e[t]&&e[t].match(r));case"Number":r=String(r);case"String":return isArray(e[t])?!!a&&arrayContains(e[t],r):e[t]===r;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}};URI.joinPaths=function(){var e=[];var t=[];var r=0;for(var a=0;a<arguments.length;a++){var s=new URI(arguments[a]);e.push(s);var n=s.segment();for(var i=0;i<n.length;i++){"string"===typeof n[i]&&t.push(n[i]);n[i]&&r++}}if(!t.length||!r)return new URI("");var o=new URI("").segment(t);""!==e[0].path()&&"/"!==e[0].path().slice(0,1)||o.path("/"+o.path());return o.normalize()};URI.commonPath=function(e,t){var r=Math.min(e.length,t.length);var a;for(a=0;a<r;a++)if(e.charAt(a)!==t.charAt(a)){a--;break}if(a<1)return e.charAt(0)===t.charAt(0)&&"/"===e.charAt(0)?"/":"";"/"===e.charAt(a)&&"/"===t.charAt(a)||(a=e.substring(0,a).lastIndexOf("/"));return e.substring(0,a+1)};URI.withinString=function(e,t,r){r||(r={});var a=r.start||URI.findUri.start;var s=r.end||URI.findUri.end;var n=r.trim||URI.findUri.trim;var i=r.parens||URI.findUri.parens;var o=/[a-z0-9-]=["']?$/i;a.lastIndex=0;while(true){var u=a.exec(e);if(!u)break;var h=u.index;if(r.ignoreHtml){var p=e.slice(Math.max(h-3,0),h);if(p&&o.test(p))continue}var l=h+e.slice(h).search(s);var c=e.slice(h,l);var f=-1;while(true){var d=i.exec(c);if(!d)break;var m=d.index+d[0].length;f=Math.max(f,m)}c=f>-1?c.slice(0,f)+c.slice(f).replace(n,""):c.replace(n,"");if(!(c.length<=u[0].length)&&(!r.ignore||!r.ignore.test(c))){l=h+c.length;var v=t(c,h,l,e);if(void 0!==v){v=String(v);e=e.slice(0,h)+v+e.slice(l);a.lastIndex=h+v.length}else a.lastIndex=l}}a.lastIndex=0;return e};URI.ensureValidHostname=function(t,r){var a=!!t;var s=!!r;var n=false;s&&(n=arrayContains(URI.hostProtocols,r));if(n&&!a)throw new TypeError("Hostname cannot be empty, if protocol is "+r);if(t&&t.match(URI.invalid_hostname_characters)){if(!e)throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-:_] and Punycode.js is not available');if(e.toASCII(t).match(URI.invalid_hostname_characters))throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-:_]')}};URI.ensureValidPort=function(e){if(e){var t=Number(e);if(!(isInteger(t)&&t>0&&t<65536))throw new TypeError('Port "'+e+'" is not a valid port')}};URI.noConflict=function(e){if(e){var t={URI:this.noConflict()};s.URITemplate&&"function"===typeof s.URITemplate.noConflict&&(t.URITemplate=s.URITemplate.noConflict());s.IPv6&&"function"===typeof s.IPv6.noConflict&&(t.IPv6=s.IPv6.noConflict());s.SecondLevelDomains&&"function"===typeof s.SecondLevelDomains.noConflict&&(t.SecondLevelDomains=s.SecondLevelDomains.noConflict());return t}s.URI===(this||a)&&(s.URI=n);return this||a};i.build=function(e){if(true===e)(this||a)._deferred_build=true;else if(void 0===e||(this||a)._deferred_build){(this||a)._string=URI.build((this||a)._parts);(this||a)._deferred_build=false}return this||a};i.clone=function(){return new URI(this||a)};i.valueOf=i.toString=function(){return this.build(false)._string};function generateSimpleAccessor(e){return function(t,r){if(void 0===t)return(this||a)._parts[e]||"";(this||a)._parts[e]=t||null;this.build(!r);return this||a}}function generatePrefixAccessor(e,t){return function(r,s){if(void 0===r)return(this||a)._parts[e]||"";if(null!==r){r+="";r.charAt(0)===t&&(r=r.substring(1))}(this||a)._parts[e]=r;this.build(!s);return this||a}}i.protocol=generateSimpleAccessor("protocol");i.username=generateSimpleAccessor("username");i.password=generateSimpleAccessor("password");i.hostname=generateSimpleAccessor("hostname");i.port=generateSimpleAccessor("port");i.query=generatePrefixAccessor("query","?");i.fragment=generatePrefixAccessor("fragment","#");i.search=function(e,t){var r=this.query(e,t);return"string"===typeof r&&r.length?"?"+r:r};i.hash=function(e,t){var r=this.fragment(e,t);return"string"===typeof r&&r.length?"#"+r:r};i.pathname=function(e,t){if(void 0===e||true===e){var r=(this||a)._parts.path||((this||a)._parts.hostname?"/":"");return e?((this||a)._parts.urn?URI.decodeUrnPath:URI.decodePath)(r):r}(this||a)._parts.urn?(this||a)._parts.path=e?URI.recodeUrnPath(e):"":(this||a)._parts.path=e?URI.recodePath(e):"/";this.build(!t);return this||a};i.path=i.pathname;i.href=function(e,t){var r;if(void 0===e)return this.toString();(this||a)._string="";(this||a)._parts=URI._parts();var s=e instanceof URI;var n="object"===typeof e&&(e.hostname||e.path||e.pathname);if(e.nodeName){var i=URI.getDomAttribute(e);e=e[i]||"";n=false}!s&&n&&void 0!==e.pathname&&(e=e.toString());if("string"===typeof e||e instanceof String)(this||a)._parts=URI.parse(String(e),(this||a)._parts);else{if(!s&&!n)throw new TypeError("invalid input");var u=s?e._parts:e;for(r in u)"query"!==r&&o.call((this||a)._parts,r)&&((this||a)._parts[r]=u[r]);u.query&&this.query(u.query,false)}this.build(!t);return this||a};i.is=function(e){var t=false;var s=false;var n=false;var i=false;var o=false;var u=false;var h=false;var p=!(this||a)._parts.urn;if((this||a)._parts.hostname){p=false;s=URI.ip4_expression.test((this||a)._parts.hostname);n=URI.ip6_expression.test((this||a)._parts.hostname);t=s||n;i=!t;o=i&&r&&r.has((this||a)._parts.hostname);u=i&&URI.idn_expression.test((this||a)._parts.hostname);h=i&&URI.punycode_expression.test((this||a)._parts.hostname)}switch(e.toLowerCase()){case"relative":return p;case"absolute":return!p;case"domain":case"name":return i;case"sld":return o;case"ip":return t;case"ip4":case"ipv4":case"inet4":return s;case"ip6":case"ipv6":case"inet6":return n;case"idn":return u;case"url":return!(this||a)._parts.urn;case"urn":return!!(this||a)._parts.urn;case"punycode":return h}return null};var p=i.protocol;var l=i.port;var c=i.hostname;i.protocol=function(e,t){if(e){e=e.replace(/:(\/\/)?$/,"");if(!e.match(URI.protocol_expression))throw new TypeError('Protocol "'+e+"\" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]")}return p.call(this||a,e,t)};i.scheme=i.protocol;i.port=function(e,t){if((this||a)._parts.urn)return void 0===e?"":this||a;if(void 0!==e){0===e&&(e=null);if(e){e+="";":"===e.charAt(0)&&(e=e.substring(1));URI.ensureValidPort(e)}}return l.call(this||a,e,t)};i.hostname=function(e,t){if((this||a)._parts.urn)return void 0===e?"":this||a;if(void 0!==e){var r={preventInvalidHostname:(this||a)._parts.preventInvalidHostname};var s=URI.parseHost(e,r);if("/"!==s)throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');e=r.hostname;(this||a)._parts.preventInvalidHostname&&URI.ensureValidHostname(e,(this||a)._parts.protocol)}return c.call(this||a,e,t)};i.origin=function(e,t){if((this||a)._parts.urn)return void 0===e?"":this||a;if(void 0===e){var r=this.protocol();var s=this.authority();return s?(r?r+"://":"")+this.authority():""}var n=URI(e);this.protocol(n.protocol()).authority(n.authority()).build(!t);return this||a};i.host=function(e,t){if((this||a)._parts.urn)return void 0===e?"":this||a;if(void 0===e)return(this||a)._parts.hostname?URI.buildHost((this||a)._parts):"";var r=URI.parseHost(e,(this||a)._parts);if("/"!==r)throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');this.build(!t);return this||a};i.authority=function(e,t){if((this||a)._parts.urn)return void 0===e?"":this||a;if(void 0===e)return(this||a)._parts.hostname?URI.buildAuthority((this||a)._parts):"";var r=URI.parseAuthority(e,(this||a)._parts);if("/"!==r)throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');this.build(!t);return this||a};i.userinfo=function(e,t){if((this||a)._parts.urn)return void 0===e?"":this||a;if(void 0===e){var r=URI.buildUserinfo((this||a)._parts);return r?r.substring(0,r.length-1):r}"@"!==e[e.length-1]&&(e+="@");URI.parseUserinfo(e,(this||a)._parts);this.build(!t);return this||a};i.resource=function(e,t){var r;if(void 0===e)return this.path()+this.search()+this.hash();r=URI.parse(e);(this||a)._parts.path=r.path;(this||a)._parts.query=r.query;(this||a)._parts.fragment=r.fragment;this.build(!t);return this||a};i.subdomain=function(e,t){if((this||a)._parts.urn)return void 0===e?"":this||a;if(void 0===e){if(!(this||a)._parts.hostname||this.is("IP"))return"";var r=(this||a)._parts.hostname.length-this.domain().length-1;return(this||a)._parts.hostname.substring(0,r)||""}var s=(this||a)._parts.hostname.length-this.domain().length;var n=(this||a)._parts.hostname.substring(0,s);var i=new RegExp("^"+escapeRegEx(n));e&&"."!==e.charAt(e.length-1)&&(e+=".");if(-1!==e.indexOf(":"))throw new TypeError("Domains cannot contain colons");e&&URI.ensureValidHostname(e,(this||a)._parts.protocol);(this||a)._parts.hostname=(this||a)._parts.hostname.replace(i,e);this.build(!t);return this||a};i.domain=function(e,t){if((this||a)._parts.urn)return void 0===e?"":this||a;if("boolean"===typeof e){t=e;e=void 0}if(void 0===e){if(!(this||a)._parts.hostname||this.is("IP"))return"";var r=(this||a)._parts.hostname.match(/\./g);if(r&&r.length<2)return(this||a)._parts.hostname;var s=(this||a)._parts.hostname.length-this.tld(t).length-1;s=(this||a)._parts.hostname.lastIndexOf(".",s-1)+1;return(this||a)._parts.hostname.substring(s)||""}if(!e)throw new TypeError("cannot set domain empty");if(-1!==e.indexOf(":"))throw new TypeError("Domains cannot contain colons");URI.ensureValidHostname(e,(this||a)._parts.protocol);if(!(this||a)._parts.hostname||this.is("IP"))(this||a)._parts.hostname=e;else{var n=new RegExp(escapeRegEx(this.domain())+"$");(this||a)._parts.hostname=(this||a)._parts.hostname.replace(n,e)}this.build(!t);return this||a};i.tld=function(e,t){if((this||a)._parts.urn)return void 0===e?"":this||a;if("boolean"===typeof e){t=e;e=void 0}if(void 0===e){if(!(this||a)._parts.hostname||this.is("IP"))return"";var s=(this||a)._parts.hostname.lastIndexOf(".");var n=(this||a)._parts.hostname.substring(s+1);return true!==t&&r&&r.list[n.toLowerCase()]&&r.get((this||a)._parts.hostname)||n}var i;if(!e)throw new TypeError("cannot set TLD empty");if(e.match(/[^a-zA-Z0-9-]/)){if(!r||!r.is(e))throw new TypeError('TLD "'+e+'" contains characters other than [A-Z0-9]');i=new RegExp(escapeRegEx(this.tld())+"$");(this||a)._parts.hostname=(this||a)._parts.hostname.replace(i,e)}else{if(!(this||a)._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");i=new RegExp(escapeRegEx(this.tld())+"$");(this||a)._parts.hostname=(this||a)._parts.hostname.replace(i,e)}this.build(!t);return this||a};i.directory=function(e,t){if((this||a)._parts.urn)return void 0===e?"":this||a;if(void 0===e||true===e){if(!(this||a)._parts.path&&!(this||a)._parts.hostname)return"";if("/"===(this||a)._parts.path)return"/";var r=(this||a)._parts.path.length-this.filename().length-1;var s=(this||a)._parts.path.substring(0,r)||((this||a)._parts.hostname?"/":"");return e?URI.decodePath(s):s}var n=(this||a)._parts.path.length-this.filename().length;var i=(this||a)._parts.path.substring(0,n);var o=new RegExp("^"+escapeRegEx(i));if(!this.is("relative")){e||(e="/");"/"!==e.charAt(0)&&(e="/"+e)}e&&"/"!==e.charAt(e.length-1)&&(e+="/");e=URI.recodePath(e);(this||a)._parts.path=(this||a)._parts.path.replace(o,e);this.build(!t);return this||a};i.filename=function(e,t){if((this||a)._parts.urn)return void 0===e?"":this||a;if("string"!==typeof e){if(!(this||a)._parts.path||"/"===(this||a)._parts.path)return"";var r=(this||a)._parts.path.lastIndexOf("/");var s=(this||a)._parts.path.substring(r+1);return e?URI.decodePathSegment(s):s}var n=false;"/"===e.charAt(0)&&(e=e.substring(1));e.match(/\.?\//)&&(n=true);var i=new RegExp(escapeRegEx(this.filename())+"$");e=URI.recodePath(e);(this||a)._parts.path=(this||a)._parts.path.replace(i,e);n?this.normalizePath(t):this.build(!t);return this||a};i.suffix=function(e,t){if((this||a)._parts.urn)return void 0===e?"":this||a;if(void 0===e||true===e){if(!(this||a)._parts.path||"/"===(this||a)._parts.path)return"";var r=this.filename();var s=r.lastIndexOf(".");var n,i;if(-1===s)return"";n=r.substring(s+1);i=/^[a-z0-9%]+$/i.test(n)?n:"";return e?URI.decodePathSegment(i):i}"."===e.charAt(0)&&(e=e.substring(1));var o=this.suffix();var u;if(o)u=e?new RegExp(escapeRegEx(o)+"$"):new RegExp(escapeRegEx("."+o)+"$");else{if(!e)return this||a;(this||a)._parts.path+="."+URI.recodePath(e)}if(u){e=URI.recodePath(e);(this||a)._parts.path=(this||a)._parts.path.replace(u,e)}this.build(!t);return this||a};i.segment=function(e,t,r){var s=(this||a)._parts.urn?":":"/";var n=this.path();var i="/"===n.substring(0,1);var o=n.split(s);if(void 0!==e&&"number"!==typeof e){r=t;t=e;e=void 0}if(void 0!==e&&"number"!==typeof e)throw new Error('Bad segment "'+e+'", must be 0-based integer');i&&o.shift();e<0&&(e=Math.max(o.length+e,0));if(void 0===t)return void 0===e?o:o[e];if(null===e||void 0===o[e]){if(isArray(t)){o=[];for(var u=0,h=t.length;u<h;u++)if(t[u].length||o.length&&o[o.length-1].length){o.length&&!o[o.length-1].length&&o.pop();o.push(trimSlashes(t[u]))}}else if(t||"string"===typeof t){t=trimSlashes(t);""===o[o.length-1]?o[o.length-1]=t:o.push(t)}}else t?o[e]=trimSlashes(t):o.splice(e,1);i&&o.unshift("");return this.path(o.join(s),r)};i.segmentCoded=function(e,t,r){var a,s,n;if("number"!==typeof e){r=t;t=e;e=void 0}if(void 0===t){a=this.segment(e,t,r);if(isArray(a))for(s=0,n=a.length;s<n;s++)a[s]=URI.decode(a[s]);else a=void 0!==a?URI.decode(a):void 0;return a}if(isArray(t))for(s=0,n=t.length;s<n;s++)t[s]=URI.encode(t[s]);else t="string"===typeof t||t instanceof String?URI.encode(t):t;return this.segment(e,t,r)};var f=i.query;i.query=function(e,t){if(true===e)return URI.parseQuery((this||a)._parts.query,(this||a)._parts.escapeQuerySpace);if("function"===typeof e){var r=URI.parseQuery((this||a)._parts.query,(this||a)._parts.escapeQuerySpace);var s=e.call(this||a,r);(this||a)._parts.query=URI.buildQuery(s||r,(this||a)._parts.duplicateQueryParameters,(this||a)._parts.escapeQuerySpace);this.build(!t);return this||a}if(void 0!==e&&"string"!==typeof e){(this||a)._parts.query=URI.buildQuery(e,(this||a)._parts.duplicateQueryParameters,(this||a)._parts.escapeQuerySpace);this.build(!t);return this||a}return f.call(this||a,e,t)};i.setQuery=function(e,t,r){var s=URI.parseQuery((this||a)._parts.query,(this||a)._parts.escapeQuerySpace);if("string"===typeof e||e instanceof String)s[e]=void 0!==t?t:null;else{if("object"!==typeof e)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");for(var n in e)o.call(e,n)&&(s[n]=e[n])}(this||a)._parts.query=URI.buildQuery(s,(this||a)._parts.duplicateQueryParameters,(this||a)._parts.escapeQuerySpace);"string"!==typeof e&&(r=t);this.build(!r);return this||a};i.addQuery=function(e,t,r){var s=URI.parseQuery((this||a)._parts.query,(this||a)._parts.escapeQuerySpace);URI.addQuery(s,e,void 0===t?null:t);(this||a)._parts.query=URI.buildQuery(s,(this||a)._parts.duplicateQueryParameters,(this||a)._parts.escapeQuerySpace);"string"!==typeof e&&(r=t);this.build(!r);return this||a};i.removeQuery=function(e,t,r){var s=URI.parseQuery((this||a)._parts.query,(this||a)._parts.escapeQuerySpace);URI.removeQuery(s,e,t);(this||a)._parts.query=URI.buildQuery(s,(this||a)._parts.duplicateQueryParameters,(this||a)._parts.escapeQuerySpace);"string"!==typeof e&&(r=t);this.build(!r);return this||a};i.hasQuery=function(e,t,r){var s=URI.parseQuery((this||a)._parts.query,(this||a)._parts.escapeQuerySpace);return URI.hasQuery(s,e,t,r)};i.setSearch=i.setQuery;i.addSearch=i.addQuery;i.removeSearch=i.removeQuery;i.hasSearch=i.hasQuery;i.normalize=function(){return(this||a)._parts.urn?this.normalizeProtocol(false).normalizePath(false).normalizeQuery(false).normalizeFragment(false).build():this.normalizeProtocol(false).normalizeHostname(false).normalizePort(false).normalizePath(false).normalizeQuery(false).normalizeFragment(false).build()};i.normalizeProtocol=function(e){if("string"===typeof(this||a)._parts.protocol){(this||a)._parts.protocol=(this||a)._parts.protocol.toLowerCase();this.build(!e)}return this||a};i.normalizeHostname=function(r){if((this||a)._parts.hostname){this.is("IDN")&&e?(this||a)._parts.hostname=e.toASCII((this||a)._parts.hostname):this.is("IPv6")&&t&&((this||a)._parts.hostname=t.best((this||a)._parts.hostname));(this||a)._parts.hostname=(this||a)._parts.hostname.toLowerCase();this.build(!r)}return this||a};i.normalizePort=function(e){if("string"===typeof(this||a)._parts.protocol&&(this||a)._parts.port===URI.defaultPorts[(this||a)._parts.protocol]){(this||a)._parts.port=null;this.build(!e)}return this||a};i.normalizePath=function(e){var t=(this||a)._parts.path;if(!t)return this||a;if((this||a)._parts.urn){(this||a)._parts.path=URI.recodeUrnPath((this||a)._parts.path);this.build(!e);return this||a}if("/"===(this||a)._parts.path)return this||a;t=URI.recodePath(t);var r;var s="";var n,i;if("/"!==t.charAt(0)){r=true;t="/"+t}"/.."!==t.slice(-3)&&"/."!==t.slice(-2)||(t+="/");t=t.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/");if(r){s=t.substring(1).match(/^(\.\.\/)+/)||"";s&&(s=s[0])}while(true){n=t.search(/\/\.\.(\/|$)/);if(-1===n)break;if(0!==n){i=t.substring(0,n).lastIndexOf("/");-1===i&&(i=n);t=t.substring(0,i)+t.substring(n+3)}else t=t.substring(3)}r&&this.is("relative")&&(t=s+t.substring(1));(this||a)._parts.path=t;this.build(!e);return this||a};i.normalizePathname=i.normalizePath;i.normalizeQuery=function(e){if("string"===typeof(this||a)._parts.query){(this||a)._parts.query.length?this.query(URI.parseQuery((this||a)._parts.query,(this||a)._parts.escapeQuerySpace)):(this||a)._parts.query=null;this.build(!e)}return this||a};i.normalizeFragment=function(e){if(!(this||a)._parts.fragment){(this||a)._parts.fragment=null;this.build(!e)}return this||a};i.normalizeSearch=i.normalizeQuery;i.normalizeHash=i.normalizeFragment;i.iso8859=function(){var e=URI.encode;var t=URI.decode;URI.encode=escape;URI.decode=decodeURIComponent;try{this.normalize()}finally{URI.encode=e;URI.decode=t}return this||a};i.unicode=function(){var e=URI.encode;var t=URI.decode;URI.encode=strictEncodeURIComponent;URI.decode=unescape;try{this.normalize()}finally{URI.encode=e;URI.decode=t}return this||a};i.readable=function(){var t=this.clone();t.username("").password("").normalize();var r="";t._parts.protocol&&(r+=t._parts.protocol+"://");if(t._parts.hostname)if(t.is("punycode")&&e){r+=e.toUnicode(t._parts.hostname);t._parts.port&&(r+=":"+t._parts.port)}else r+=t.host();t._parts.hostname&&t._parts.path&&"/"!==t._parts.path.charAt(0)&&(r+="/");r+=t.path(true);if(t._parts.query){var s="";for(var n=0,i=t._parts.query.split("&"),o=i.length;n<o;n++){var u=(i[n]||"").split("=");s+="&"+URI.decodeQuery(u[0],(this||a)._parts.escapeQuerySpace).replace(/&/g,"%26");void 0!==u[1]&&(s+="="+URI.decodeQuery(u[1],(this||a)._parts.escapeQuerySpace).replace(/&/g,"%26"))}r+="?"+s.substring(1)}r+=URI.decodeQuery(t.hash(),true);return r};i.absoluteTo=function(e){var t=this.clone();var r=["protocol","username","password","hostname","port"];var s,n,i;if((this||a)._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");e instanceof URI||(e=new URI(e));if(t._parts.protocol)return t;t._parts.protocol=e._parts.protocol;if((this||a)._parts.hostname)return t;for(n=0;i=r[n];n++)t._parts[i]=e._parts[i];if(t._parts.path){".."===t._parts.path.substring(-2)&&(t._parts.path+="/");if("/"!==t.path().charAt(0)){s=e.directory();s=s||(0===e.path().indexOf("/")?"/":"");t._parts.path=(s?s+"/":"")+t._parts.path;t.normalizePath()}}else{t._parts.path=e._parts.path;t._parts.query||(t._parts.query=e._parts.query)}t.build();return t};i.relativeTo=function(e){var t=this.clone().normalize();var r,a,s,n,i;if(t._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");e=new URI(e).normalize();r=t._parts;a=e._parts;n=t.path();i=e.path();if("/"!==n.charAt(0))throw new Error("URI is already relative");if("/"!==i.charAt(0))throw new Error("Cannot calculate a URI relative to another relative URI");r.protocol===a.protocol&&(r.protocol=null);if(r.username!==a.username||r.password!==a.password)return t.build();if(null!==r.protocol||null!==r.username||null!==r.password)return t.build();if(r.hostname!==a.hostname||r.port!==a.port)return t.build();r.hostname=null;r.port=null;if(n===i){r.path="";return t.build()}s=URI.commonPath(n,i);if(!s)return t.build();var o=a.path.substring(s.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");r.path=o+r.path.substring(s.length)||"./";return t.build()};i.equals=function(e){var t=this.clone();var r=new URI(e);var s={};var n={};var i={};var u,h,p;t.normalize();r.normalize();if(t.toString()===r.toString())return true;u=t.query();h=r.query();t.query("");r.query("");if(t.toString()!==r.toString())return false;if(u.length!==h.length)return false;s=URI.parseQuery(u,(this||a)._parts.escapeQuerySpace);n=URI.parseQuery(h,(this||a)._parts.escapeQuerySpace);for(p in s)if(o.call(s,p)){if(isArray(s[p])){if(!arraysEqual(s[p],n[p]))return false}else if(s[p]!==n[p])return false;i[p]=true}for(p in n)if(o.call(n,p)&&!i[p])return false;return true};i.preventInvalidHostname=function(e){(this||a)._parts.preventInvalidHostname=!!e;return this||a};i.duplicateQueryParameters=function(e){(this||a)._parts.duplicateQueryParameters=!!e;return this||a};i.escapeQuerySpace=function(e){(this||a)._parts.escapeQuerySpace=!!e;return this||a};return URI}));var n=s;export{n as default};

