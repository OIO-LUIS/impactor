// lerc@2.0.0 downloaded from https://ga.jspm.io/npm:lerc@2.0.0/LercDecode.js

var e="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var r={};
/* Copyright 2015-2018 Esri. Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0 @preserve */(function(){var a=function(){var e={};e.defaultNoDataValue=-34027999387901484e22;e.decode=function(r,a){a=a||{};var t=a.encodedMaskData||null===a.encodedMaskData;var i=parse(r,a.inputOffset||0,t);var n=null!==a.noDataValue?a.noDataValue:e.defaultNoDataValue;var s=uncompressPixelValues(i,a.pixelType||Float32Array,a.encodedMaskData,n,a.returnMask);var l={width:i.width,height:i.height,pixelData:s.resultPixels,minValue:s.minValue,maxValue:i.pixels.maxValue,noDataValue:n};s.resultMask&&(l.maskData=s.resultMask);a.returnEncodedMask&&i.mask&&(l.encodedMaskData=i.mask.bitset?i.mask.bitset:null);if(a.returnFileInfo){l.fileInfo=formatFileInfo(i);a.computeUsedBitDepths&&(l.fileInfo.bitDepths=computeUsedBitDepths(i))}return l};var uncompressPixelValues=function(e,r,a,t,i){var n=0;var s=e.pixels.numBlocksX;var l=e.pixels.numBlocksY;var f=Math.floor(e.width/s);var u=Math.floor(e.height/l);var o=2*e.maxZError;var v=Number.MAX_VALUE,c;a=a||(e.mask?e.mask.bitset:null);var h,d;h=new r(e.width*e.height);i&&a&&(d=new Uint8Array(e.width*e.height));var m=new Float32Array(f*u);var g,p;for(var w=0;w<=l;w++){var k=w!==l?u:e.height%l;if(0!==k)for(var x=0;x<=s;x++){var y=x!==s?f:e.width%s;if(0!==y){var U=w*e.width*u+x*f;var b=e.width-y;var I=e.pixels.blocks[n];var V,M,D;if(I.encoding<2){if(0===I.encoding)V=I.rawData;else{unstuff(I.stuffedData,I.bitsPerPixel,I.numValidPixels,I.offset,o,m,e.pixels.maxValue);V=m}M=0}else D=2===I.encoding?0:I.offset;var A;if(a)for(p=0;p<k;p++){if(7&U){A=a[U>>3];A<<=7&U}for(g=0;g<y;g++){7&U||(A=a[U>>3]);if(128&A){d&&(d[U]=1);c=I.encoding<2?V[M++]:D;v=v>c?c:v;h[U++]=c}else{d&&(d[U]=0);h[U++]=t}A<<=1}U+=b}else if(I.encoding<2)for(p=0;p<k;p++){for(g=0;g<y;g++){c=V[M++];v=v>c?c:v;h[U++]=c}U+=b}else{v=v>D?D:v;for(p=0;p<k;p++){for(g=0;g<y;g++)h[U++]=D;U+=b}}if(1===I.encoding&&M!==I.numValidPixels)throw"Block and Mask do not match";n++}}}return{resultPixels:h,resultMask:d,minValue:v}};var formatFileInfo=function(e){return{fileIdentifierString:e.fileIdentifierString,fileVersion:e.fileVersion,imageType:e.imageType,height:e.height,width:e.width,maxZError:e.maxZError,eofOffset:e.eofOffset,mask:e.mask?{numBlocksX:e.mask.numBlocksX,numBlocksY:e.mask.numBlocksY,numBytes:e.mask.numBytes,maxValue:e.mask.maxValue}:null,pixels:{numBlocksX:e.pixels.numBlocksX,numBlocksY:e.pixels.numBlocksY,numBytes:e.pixels.numBytes,maxValue:e.pixels.maxValue,noDataValue:e.noDataValue}}};var computeUsedBitDepths=function(e){var r=e.pixels.numBlocksX*e.pixels.numBlocksY;var a={};for(var t=0;t<r;t++){var i=e.pixels.blocks[t];0===i.encoding?a.float32=true:1===i.encoding?a[i.bitsPerPixel]=true:a[0]=true}return Object.keys(a)};var parse=function(e,r,a){var t={};var i=new Uint8Array(e,r,10);t.fileIdentifierString=String.fromCharCode.apply(null,i);if("CntZImage"!==t.fileIdentifierString.trim())throw"Unexpected file identifier string: "+t.fileIdentifierString;r+=10;var n=new DataView(e,r,24);t.fileVersion=n.getInt32(0,true);t.imageType=n.getInt32(4,true);t.height=n.getUint32(8,true);t.width=n.getUint32(12,true);t.maxZError=n.getFloat64(16,true);r+=24;if(!a){n=new DataView(e,r,16);t.mask={};t.mask.numBlocksY=n.getUint32(0,true);t.mask.numBlocksX=n.getUint32(4,true);t.mask.numBytes=n.getUint32(8,true);t.mask.maxValue=n.getFloat32(12,true);r+=16;if(t.mask.numBytes>0){var s=new Uint8Array(Math.ceil(t.width*t.height/8));n=new DataView(e,r,t.mask.numBytes);var l=n.getInt16(0,true);var f=2,u=0;do{if(l>0)while(l--)s[u++]=n.getUint8(f++);else{var o=n.getUint8(f++);l=-l;while(l--)s[u++]=o}l=n.getInt16(f,true);f+=2}while(f<t.mask.numBytes);if(-32768!==l||u<s.length)throw"Unexpected end of mask RLE encoding";t.mask.bitset=s;r+=t.mask.numBytes}else 0===(t.mask.numBytes|t.mask.numBlocksY|t.mask.maxValue)&&(t.mask.bitset=new Uint8Array(Math.ceil(t.width*t.height/8)))}n=new DataView(e,r,16);t.pixels={};t.pixels.numBlocksY=n.getUint32(0,true);t.pixels.numBlocksX=n.getUint32(4,true);t.pixels.numBytes=n.getUint32(8,true);t.pixels.maxValue=n.getFloat32(12,true);r+=16;var v=t.pixels.numBlocksX;var c=t.pixels.numBlocksY;var h=v+(t.width%v>0?1:0);var d=c+(t.height%c>0?1:0);t.pixels.blocks=new Array(h*d);var m=0;for(var g=0;g<d;g++)for(var p=0;p<h;p++){var w=0;var k=e.byteLength-r;n=new DataView(e,r,Math.min(10,k));var x={};t.pixels.blocks[m++]=x;var y=n.getUint8(0);w++;x.encoding=63&y;if(x.encoding>3)throw"Invalid block encoding ("+x.encoding+")";if(2!==x.encoding){if(0!==y&&2!==y){y>>=6;x.offsetType=y;if(2===y){x.offset=n.getInt8(1);w++}else if(1===y){x.offset=n.getInt16(1,true);w+=2}else{if(0!==y)throw"Invalid block offset type";x.offset=n.getFloat32(1,true);w+=4}if(1===x.encoding){y=n.getUint8(w);w++;x.bitsPerPixel=63&y;y>>=6;x.numValidPixelsType=y;if(2===y){x.numValidPixels=n.getUint8(w);w++}else if(1===y){x.numValidPixels=n.getUint16(w,true);w+=2}else{if(0!==y)throw"Invalid valid pixel count type";x.numValidPixels=n.getUint32(w,true);w+=4}}}r+=w;if(3!==x.encoding){var U,b;if(0===x.encoding){var I=(t.pixels.numBytes-1)/4;if(I!==Math.floor(I))throw"uncompressed block has invalid length";U=new ArrayBuffer(4*I);b=new Uint8Array(U);b.set(new Uint8Array(e,r,4*I));var V=new Float32Array(U);x.rawData=V;r+=4*I}else if(1===x.encoding){var M=Math.ceil(x.numValidPixels*x.bitsPerPixel/8);var D=Math.ceil(M/4);U=new ArrayBuffer(4*D);b=new Uint8Array(U);b.set(new Uint8Array(e,r,M));x.stuffedData=new Uint32Array(U);r+=M}}}else r++}t.eofOffset=r;return t};var unstuff=function(e,r,a,t,i,n,s){var l=(1<<r)-1;var f=0,u;var o=0;var v,c;var h=Math.ceil((s-t)/i);var d=4*e.length-Math.ceil(r*a/8);e[e.length-1]<<=8*d;for(u=0;u<a;u++){if(0===o){c=e[f++];o=32}if(o>=r){v=c>>>o-r&l;o-=r}else{var m=r-o;v=(c&l)<<m&l;c=e[f++];o=32-m;v+=c>>>o}n[u]=v<h?t+v*i:s}return n};return e}();var t=function(){var r={unstuff:function(e,r,a,t,i,n,s,l){var f=(1<<a)-1;var u=0,o;var v=0;var c,h,d,m;var g=4*e.length-Math.ceil(a*t/8);e[e.length-1]<<=8*g;if(i)for(o=0;o<t;o++){if(0===v){h=e[u++];v=32}if(v>=a){c=h>>>v-a&f;v-=a}else{d=a-v;c=(h&f)<<d&f;h=e[u++];v=32-d;c+=h>>>v}r[o]=i[c]}else{m=Math.ceil((l-n)/s);for(o=0;o<t;o++){if(0===v){h=e[u++];v=32}if(v>=a){c=h>>>v-a&f;v-=a}else{d=a-v;c=(h&f)<<d&f;h=e[u++];v=32-d;c+=h>>>v}r[o]=c<m?n+c*s:l}}},unstuffLUT:function(e,r,a,t,i,n){var s=(1<<r)-1;var l=0,f=0,u=0,o=0,v=0;var c;var h=[];var d=4*e.length-Math.ceil(r*a/8);e[e.length-1]<<=8*d;var m=Math.ceil((n-t)/i);for(f=0;f<a;f++){if(0===o){c=e[l++];o=32}if(o>=r){v=c>>>o-r&s;o-=r}else{u=r-o;v=(c&s)<<u&s;c=e[l++];o=32-u;v+=c>>>o}h[f]=v<m?t+v*i:n}h.unshift(t);return h},unstuff2:function(e,r,a,t,i,n,s,l){var f=(1<<a)-1;var u=0,o;var v=0,c=0;var h,d,m;if(i)for(o=0;o<t;o++){if(0===v){d=e[u++];v=32;c=0}if(v>=a){h=d>>>c&f;v-=a;c+=a}else{m=a-v;h=d>>>c&f;d=e[u++];v=32-m;h|=(d&(1<<m)-1)<<a-m;c=m}r[o]=i[h]}else{var g=Math.ceil((l-n)/s);for(o=0;o<t;o++){if(0===v){d=e[u++];v=32;c=0}if(v>=a){h=d>>>c&f;v-=a;c+=a}else{m=a-v;h=d>>>c&f;d=e[u++];v=32-m;h|=(d&(1<<m)-1)<<a-m;c=m}r[o]=h<g?n+h*s:l}}return r},unstuffLUT2:function(e,r,a,t,i,n){var s=(1<<r)-1;var l=0,f=0,u=0,o=0,v=0,c=0;var h;var d=[];var m=Math.ceil((n-t)/i);for(f=0;f<a;f++){if(0===o){h=e[l++];o=32;c=0}if(o>=r){v=h>>>c&s;o-=r;c+=r}else{u=r-o;v=h>>>c&s;h=e[l++];o=32-u;v|=(h&(1<<u)-1)<<r-u;c=u}d[f]=v<m?t+v*i:n}d.unshift(t);return d},originalUnstuff:function(e,r,a,t){var i=(1<<a)-1;var n=0,s;var l=0;var f,u,o;var v=4*e.length-Math.ceil(a*t/8);e[e.length-1]<<=8*v;for(s=0;s<t;s++){if(0===l){u=e[n++];l=32}if(l>=a){f=u>>>l-a&i;l-=a}else{o=a-l;f=(u&i)<<o&i;u=e[n++];l=32-o;f+=u>>>l}r[s]=f}return r},originalUnstuff2:function(e,r,a,t){var i=(1<<a)-1;var n=0,s;var l=0,f=0;var u,o,v;for(s=0;s<t;s++){if(0===l){o=e[n++];l=32;f=0}if(l>=a){u=o>>>f&i;l-=a;f+=a}else{v=a-l;u=o>>>f&i;o=e[n++];l=32-v;u|=(o&(1<<v)-1)<<a-v;f=v}r[s]=u}return r}};var a={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(e){var r=65535,a=65535;var t=e.length;var i=Math.floor(t/2);var n=0;while(i){var s=i>=359?359:i;i-=s;do{r+=e[n++]<<8;a+=r+=e[n++]}while(--s);r=(65535&r)+(r>>>16);a=(65535&a)+(a>>>16)}1&t&&(a+=r+=e[n]<<8);r=(65535&r)+(r>>>16);a=(65535&a)+(a>>>16);return(a<<16|r)>>>0},readHeaderInfo:function(e,r){var a=r.ptr;var t=new Uint8Array(e,a,6);var i={};i.fileIdentifierString=String.fromCharCode.apply(null,t);if(0!==i.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+i.fileIdentifierString;a+=6;var n=new DataView(e,a,8);var s=n.getInt32(0,true);i.fileVersion=s;a+=4;if(s>=3){i.checksum=n.getUint32(4,true);a+=4}n=new DataView(e,a,12);i.height=n.getUint32(0,true);i.width=n.getUint32(4,true);a+=8;if(s>=4){i.numDims=n.getUint32(8,true);a+=4}else i.numDims=1;n=new DataView(e,a,40);i.numValidPixel=n.getUint32(0,true);i.microBlockSize=n.getInt32(4,true);i.blobSize=n.getInt32(8,true);i.imageType=n.getInt32(12,true);i.maxZError=n.getFloat64(16,true);i.zMin=n.getFloat64(24,true);i.zMax=n.getFloat64(32,true);a+=40;r.headerInfo=i;r.ptr=a;var l,f;if(s>=3){f=s>=4?52:48;l=this.computeChecksumFletcher32(new Uint8Array(e,a-f,i.blobSize-14));if(l!==i.checksum)throw"Checksum failed."}return true},checkMinMaxRanges:function(e,r){var a=r.headerInfo;var t=this.getDataTypeArray(a.imageType);var i=a.numDims*this.getDataTypeSize(a.imageType);var n=this.readSubArray(e,r.ptr,t,i);var s=this.readSubArray(e,r.ptr+i,t,i);r.ptr+=2*i;var l,f=true;for(l=0;l<a.numDims;l++)if(n[l]!==s[l]){f=false;break}a.minValues=n;a.maxValues=s;return f},readSubArray:function(e,r,a,t){var i;if(a===Uint8Array)i=new Uint8Array(e,r,t);else{var n=new ArrayBuffer(t);var s=new Uint8Array(n);s.set(new Uint8Array(e,r,t));i=new a(n)}return i},readMask:function(e,r){var a=r.ptr;var t=r.headerInfo;var i=t.width*t.height;var n=t.numValidPixel;var s=new DataView(e,a,4);var l={};l.numBytes=s.getUint32(0,true);a+=4;if((0===n||i===n)&&0!==l.numBytes)throw"invalid mask";var f,u;if(0===n){f=new Uint8Array(Math.ceil(i/8));l.bitset=f;u=new Uint8Array(i);r.pixels.resultMask=u;a+=l.numBytes}else if(l.numBytes>0){f=new Uint8Array(Math.ceil(i/8));s=new DataView(e,a,l.numBytes);var o=s.getInt16(0,true);var v=2,c=0,h=0;do{if(o>0)while(o--)f[c++]=s.getUint8(v++);else{h=s.getUint8(v++);o=-o;while(o--)f[c++]=h}o=s.getInt16(v,true);v+=2}while(v<l.numBytes);if(-32768!==o||c<f.length)throw"Unexpected end of mask RLE encoding";u=new Uint8Array(i);var d=0,m=0;for(m=0;m<i;m++){if(7&m){d=f[m>>3];d<<=7&m}else d=f[m>>3];128&d&&(u[m]=1)}r.pixels.resultMask=u;l.bitset=f;a+=l.numBytes}r.ptr=a;r.mask=l;return true},readDataOneSweep:function(e,r,t){var i=r.ptr;var n=r.headerInfo;var s=n.numDims;var l=n.width*n.height;var f=n.imageType;var u=n.numValidPixel*a.getDataTypeSize(f)*s;var o;var v=r.pixels.resultMask;if(t===Uint8Array)o=new Uint8Array(e,i,u);else{var c=new ArrayBuffer(u);var h=new Uint8Array(c);h.set(new Uint8Array(e,i,u));o=new t(c)}if(o.length===l*s)r.pixels.resultPixels=o;else{r.pixels.resultPixels=new t(l*s);var d=0,m=0,g=0,p=0;if(s>1)for(g=0;g<s;g++){p=g*l;for(m=0;m<l;m++)v[m]&&(r.pixels.resultPixels[p+m]=o[d++])}else for(m=0;m<l;m++)v[m]&&(r.pixels.resultPixels[m]=o[d++])}i+=u;r.ptr=i;return true},readHuffmanTree:function(r,t){var i=(this||e).HUFFMAN_LUT_BITS_MAX;var n=new DataView(r,t.ptr,16);t.ptr+=16;var s=n.getInt32(0,true);if(s<2)throw"unsupported Huffman version";var l=n.getInt32(4,true);var f=n.getInt32(8,true);var u=n.getInt32(12,true);if(f>=u)return false;var o=new Uint32Array(u-f);a.decodeBits(r,t,o);var v=[];var c,h,d,m;for(c=f;c<u;c++){h=c-(c<l?0:l);v[h]={first:o[c-f],second:null}}var g=r.byteLength-t.ptr;var p=Math.ceil(g/4);var w=new ArrayBuffer(4*p);var k=new Uint8Array(w);k.set(new Uint8Array(r,t.ptr,g));var x=new Uint32Array(w);var y=0,U,b=0;U=x[0];for(c=f;c<u;c++){h=c-(c<l?0:l);m=v[h].first;if(m>0){v[h].second=U<<y>>>32-m;if(32-y>=m){y+=m;if(32===y){y=0;b++;U=x[b]}}else{y+=m-32;b++;U=x[b];v[h].second|=U>>>32-y}}}var I=0,V=0;var M=new TreeNode;for(c=0;c<v.length;c++)void 0!==v[c]&&(I=Math.max(I,v[c].first));V=I>=i?i:I;I>=30&&console.log("WARning, large NUM LUT BITS IS "+I);var D=[],A,B,T,P,S,F;for(c=f;c<u;c++){h=c-(c<l?0:l);m=v[h].first;if(m>0){A=[m,h];if(m<=V){B=v[h].second<<V-m;T=1<<V-m;for(d=0;d<T;d++)D[B|d]=A}else{B=v[h].second;F=M;for(P=m-1;P>=0;P--){S=B>>>P&1;if(S){F.right||(F.right=new TreeNode);F=F.right}else{F.left||(F.left=new TreeNode);F=F.left}0!==P||F.val||(F.val=A[1])}}}}return{decodeLut:D,numBitsLUTQick:V,numBitsLUT:I,tree:M,stuffedData:x,srcPtr:b,bitPos:y}},readHuffman:function(e,r,a){var t=r.headerInfo;var i=t.numDims;var n=r.headerInfo.height;var s=r.headerInfo.width;var l=s*n;var f=this.readHuffmanTree(e,r);var u=f.decodeLut;var o=f.tree;var v=f.stuffedData;var c=f.srcPtr;var h=f.bitPos;var d=f.numBitsLUTQick;var m=f.numBitsLUT;var g=0===r.headerInfo.imageType?128:0;var p,w,k,x=r.pixels.resultMask,y,U,b;var I,V,M,D;var A=0;if(h>0){c++;h=0}var B=v[c];var T=1===r.encodeMode;var P=new a(l*i);var S=P;var F;for(F=0;F<t.numDims;F++){if(i>1){S=new a(P.buffer,l*F,l);A=0}if(r.headerInfo.numValidPixel===s*n)for(M=0,I=0;I<n;I++)for(V=0;V<s;V++,M++){w=0;y=B<<h>>>32-d;U=y;if(32-h<d){y|=v[c+1]>>>64-h-d;U=y}if(u[U]){w=u[U][1];h+=u[U][0]}else{y=B<<h>>>32-m;U=y;if(32-h<m){y|=v[c+1]>>>64-h-m;U=y}p=o;for(D=0;D<m;D++){b=y>>>m-D-1&1;p=b?p.right:p.left;if(!(p.left||p.right)){w=p.val;h=h+D+1;break}}}if(h>=32){h-=32;c++;B=v[c]}k=w-g;if(T){k+=V>0?A:I>0?S[M-s]:A;k&=255;S[M]=k;A=k}else S[M]=k}else for(M=0,I=0;I<n;I++)for(V=0;V<s;V++,M++)if(x[M]){w=0;y=B<<h>>>32-d;U=y;if(32-h<d){y|=v[c+1]>>>64-h-d;U=y}if(u[U]){w=u[U][1];h+=u[U][0]}else{y=B<<h>>>32-m;U=y;if(32-h<m){y|=v[c+1]>>>64-h-m;U=y}p=o;for(D=0;D<m;D++){b=y>>>m-D-1&1;p=b?p.right:p.left;if(!(p.left||p.right)){w=p.val;h=h+D+1;break}}}if(h>=32){h-=32;c++;B=v[c]}k=w-g;if(T){V>0&&x[M-1]?k+=A:I>0&&x[M-s]?k+=S[M-s]:k+=A;k&=255;S[M]=k;A=k}else S[M]=k}r.ptr=r.ptr+4*(c+1)+(h>0?4:0)}r.pixels.resultPixels=P},decodeBits:function(e,a,t,i,n){var s=a.headerInfo;var l=s.fileVersion;var f=0;var u=new DataView(e,a.ptr,5);var o=u.getUint8(0);f++;var v=o>>6;var c=0===v?4:3-v;var h=(32&o)>0;var d=31&o;var m=0;if(1===c){m=u.getUint8(f);f++}else if(2===c){m=u.getUint16(f,true);f+=2}else{if(4!==c)throw"Invalid valid pixel count type";m=u.getUint32(f,true);f+=4}var g=2*s.maxZError;var p,w,k,x,y;var U,b,I,V,M;var D=s.numDims>1?s.maxValues[n]:s.zMax;if(h){a.counter.lut++;I=u.getUint8(f);V=d;f++;x=Math.ceil((I-1)*d/8);y=Math.ceil(x/4);w=new ArrayBuffer(4*y);k=new Uint8Array(w);a.ptr+=f;k.set(new Uint8Array(e,a.ptr,x));b=new Uint32Array(w);a.ptr+=x;M=0;while(I-1>>>M)M++;x=Math.ceil(m*M/8);y=Math.ceil(x/4);w=new ArrayBuffer(4*y);k=new Uint8Array(w);k.set(new Uint8Array(e,a.ptr,x));p=new Uint32Array(w);a.ptr+=x;U=l>=3?r.unstuffLUT2(b,d,I-1,i,g,D):r.unstuffLUT(b,d,I-1,i,g,D);l>=3?r.unstuff2(p,t,M,m,U):r.unstuff(p,t,M,m,U)}else{a.counter.bitstuffer++;M=d;a.ptr+=f;if(M>0){x=Math.ceil(m*M/8);y=Math.ceil(x/4);w=new ArrayBuffer(4*y);k=new Uint8Array(w);k.set(new Uint8Array(e,a.ptr,x));p=new Uint32Array(w);a.ptr+=x;l>=3?null==i?r.originalUnstuff2(p,t,M,m):r.unstuff2(p,t,M,m,false,i,g,D):null==i?r.originalUnstuff(p,t,M,m):r.unstuff(p,t,M,m,false,i,g,D)}}},readTiles:function(e,r,t){var i=r.headerInfo;var n=i.width;var s=i.height;var l=i.microBlockSize;var f=i.imageType;var u=a.getDataTypeSize(f);var o=Math.ceil(n/l);var v=Math.ceil(s/l);r.pixels.numBlocksY=v;r.pixels.numBlocksX=o;r.pixels.ptr=0;var c=0,h=0,d=0,m=0,g=0,p=0,w=0,k=0,x=0,y=0,U=0,b=0,I=0,V=0,M=0,D=0;var A,B,T,P,S;var F;var z=new t(l*l);var L=s%l||l;var O=n%l||l;var C,X;var E=i.numDims,Y;var H=r.pixels.resultMask;var Z=r.pixels.resultPixels;for(d=0;d<v;d++){g=d!==v-1?l:L;for(m=0;m<o;m++){p=m!==o-1?l:O;U=d*n*l+m*l;b=n-p;for(Y=0;Y<E;Y++){E>1&&(Z=new t(r.pixels.resultPixels.buffer,n*s*Y*u,n*s));w=e.byteLength-r.ptr;A=new DataView(e,r.ptr,Math.min(10,w));B={};D=0;k=A.getUint8(0);D++;x=k>>6&255;y=k>>2&15;if(y!==(m*l>>3&15))throw"integrity issue";F=3&k;if(F>3){r.ptr+=D;throw"Invalid block encoding ("+F+")"}if(2!==F)if(0===F){r.counter.uncompressed++;r.ptr+=D;I=g*p*u;V=e.byteLength-r.ptr;I=I<V?I:V;T=new ArrayBuffer(I%u===0?I:I+u-I%u);P=new Uint8Array(T);P.set(new Uint8Array(e,r.ptr,I));S=new t(T);M=0;if(H)for(c=0;c<g;c++){for(h=0;h<p;h++){H[U]&&(Z[U]=S[M++]);U++}U+=b}else for(c=0;c<g;c++){for(h=0;h<p;h++)Z[U++]=S[M++];U+=b}r.ptr+=M*u}else{C=a.getDataTypeUsed(f,x);X=a.getOnePixel(B,D,C,A);D+=a.getDataTypeSize(C);if(3===F){r.ptr+=D;r.counter.constantoffset++;if(H)for(c=0;c<g;c++){for(h=0;h<p;h++){H[U]&&(Z[U]=X);U++}U+=b}else for(c=0;c<g;c++){for(h=0;h<p;h++)Z[U++]=X;U+=b}}else{r.ptr+=D;a.decodeBits(e,r,z,X,Y);D=0;if(H)for(c=0;c<g;c++){for(h=0;h<p;h++){H[U]&&(Z[U]=z[D++]);U++}U+=b}else for(c=0;c<g;c++){for(h=0;h<p;h++)Z[U++]=z[D++];U+=b}}}else{r.counter.constant++;r.ptr+=D}}}}},formatFileInfo:function(e){return{fileIdentifierString:e.headerInfo.fileIdentifierString,fileVersion:e.headerInfo.fileVersion,imageType:e.headerInfo.imageType,height:e.headerInfo.height,width:e.headerInfo.width,numValidPixel:e.headerInfo.numValidPixel,microBlockSize:e.headerInfo.microBlockSize,blobSize:e.headerInfo.blobSize,maxZError:e.headerInfo.maxZError,pixelType:a.getPixelType(e.headerInfo.imageType),eofOffset:e.eofOffset,mask:e.mask?{numBytes:e.mask.numBytes}:null,pixels:{numBlocksX:e.pixels.numBlocksX,numBlocksY:e.pixels.numBlocksY,maxValue:e.headerInfo.zMax,minValue:e.headerInfo.zMin,noDataValue:e.noDataValue}}},constructConstantSurface:function(e){var r=e.headerInfo.zMax;var a=e.headerInfo.numDims;var t=e.headerInfo.height*e.headerInfo.width;var i=t*a;var n=0,s=0,l=0;var f=e.pixels.resultMask;if(f)if(a>1)for(n=0;n<a;n++){l=n*t;for(s=0;s<t;s++)f[s]&&(e.pixels.resultPixels[l+s]=r)}else for(s=0;s<t;s++)f[s]&&(e.pixels.resultPixels[s]=r);else if(e.pixels.resultPixels.fill)e.pixels.resultPixels.fill(r);else for(s=0;s<i;s++)e.pixels.resultPixels[s]=r},getDataTypeArray:function(e){var r;switch(e){case 0:r=Int8Array;break;case 1:r=Uint8Array;break;case 2:r=Int16Array;break;case 3:r=Uint16Array;break;case 4:r=Int32Array;break;case 5:r=Uint32Array;break;case 6:r=Float32Array;break;case 7:r=Float64Array;break;default:r=Float32Array}return r},getPixelType:function(e){var r;switch(e){case 0:r="S8";break;case 1:r="U8";break;case 2:r="S16";break;case 3:r="U16";break;case 4:r="S32";break;case 5:r="U32";break;case 6:r="F32";break;case 7:r="F64";break;default:r="F32"}return r},isValidPixelValue:function(e,r){if(null==r)return false;var a;switch(e){case 0:a=r>=-128&&r<=127;break;case 1:a=r>=0&&r<=255;break;case 2:a=r>=-32768&&r<=32767;break;case 3:a=r>=0&&r<=65536;break;case 4:a=r>=-2147483648&&r<=2147483647;break;case 5:a=r>=0&&r<=4294967296;break;case 6:a=r>=-34027999387901484e22&&r<=34027999387901484e22;break;case 7:a=r>=5e-324&&r<=17976931348623157e292;break;default:a=false}return a},getDataTypeSize:function(e){var r=0;switch(e){case 0:case 1:r=1;break;case 2:case 3:r=2;break;case 4:case 5:case 6:r=4;break;case 7:r=8;break;default:r=e}return r},getDataTypeUsed:function(e,r){var a=e;switch(e){case 2:case 4:a=e-r;break;case 3:case 5:a=e-2*r;break;case 6:a=0===r?e:1===r?2:1;break;case 7:a=0===r?e:e-2*r+1;break;default:a=e;break}return a},getOnePixel:function(e,r,a,t){var i=0;switch(a){case 0:i=t.getInt8(r);break;case 1:i=t.getUint8(r);break;case 2:i=t.getInt16(r,true);break;case 3:i=t.getUint16(r,true);break;case 4:i=t.getInt32(r,true);break;case 5:i=t.getUInt32(r,true);break;case 6:i=t.getFloat32(r,true);break;case 7:i=t.getFloat64(r,true);break;default:throw"the decoder does not understand this pixel type"}return i}};var TreeNode=function(r,a,t){(this||e).val=r;(this||e).left=a;(this||e).right=t};var t={decode:function(e,r){r=r||{};var t=r.noDataValue;var i=0,n={};n.ptr=r.inputOffset||0;n.pixels={};if(a.readHeaderInfo(e,n)){var s=n.headerInfo;var l=s.fileVersion;var f=a.getDataTypeArray(s.imageType);a.readMask(e,n);s.numValidPixel===s.width*s.height||n.pixels.resultMask||(n.pixels.resultMask=r.maskData);var u=s.width*s.height;n.pixels.resultPixels=new f(u*s.numDims);n.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0};if(0!==s.numValidPixel)if(s.zMax===s.zMin)a.constructConstantSurface(n);else if(l>=4&&a.checkMinMaxRanges(e,n))a.constructConstantSurface(n);else{var o=new DataView(e,n.ptr,2);var v=o.getUint8(0);n.ptr++;if(v)a.readDataOneSweep(e,n,f);else if(l>1&&s.imageType<=1&&Math.abs(s.maxZError-.5)<1e-5){var c=o.getUint8(1);n.ptr++;n.encodeMode=c;if(c>2||l<4&&c>1)throw"Invalid Huffman flag "+c;c?a.readHuffman(e,n,f):a.readTiles(e,n,f)}else a.readTiles(e,n,f)}n.eofOffset=n.ptr;var h;if(r.inputOffset){h=n.headerInfo.blobSize+r.inputOffset-n.ptr;Math.abs(h)>=1&&(n.eofOffset=r.inputOffset+n.headerInfo.blobSize)}else{h=n.headerInfo.blobSize-n.ptr;Math.abs(h)>=1&&(n.eofOffset=n.headerInfo.blobSize)}var d={width:s.width,height:s.height,pixelData:n.pixels.resultPixels,minValue:s.zMin,maxValue:s.zMax,validPixelCount:s.numValidPixel,dimCount:s.numDims,dimStats:{minValues:s.minValues,maxValues:s.maxValues},maskData:n.pixels.resultMask};if(n.pixels.resultMask&&a.isValidPixelValue(s.imageType,t)){var m=n.pixels.resultMask;for(i=0;i<u;i++)m[i]||(d.pixelData[i]=t);d.noDataValue=t}n.noDataValue=t;r.returnFileInfo&&(d.fileInfo=a.formatFileInfo(n));return d}},getBandCount:function(e){var r=0;var t=0;var i={};i.ptr=0;i.pixels={};while(t<e.byteLength-58){a.readHeaderInfo(e,i);t+=i.headerInfo.blobSize;r++;i.ptr=t}return r}};return t}();var i=function(){var e=new ArrayBuffer(4);var r=new Uint8Array(e);var a=new Uint32Array(e);a[0]=1;return 1===r[0]}();var n={decode:function(e,r){if(!i)throw"Big endian system is not supported.";r=r||{};var n=r.inputOffset||0;var s=new Uint8Array(e,n,10);var l=String.fromCharCode.apply(null,s);var f,u;if("CntZImage"===l.trim()){f=a;u=1}else{if("Lerc2"!==l.substring(0,5))throw"Unexpected file identifier string: "+l;f=t;u=2}var o=0,v=e.byteLength-10,c,h=[],d,m;var g={width:0,height:0,pixels:[],pixelType:r.pixelType,mask:null,statistics:[]};while(n<v){var p=f.decode(e,{inputOffset:n,encodedMaskData:c,maskData:m,returnMask:0===o,returnEncodedMask:0===o,returnFileInfo:true,pixelType:r.pixelType||null,noDataValue:r.noDataValue||null});n=p.fileInfo.eofOffset;if(0===o){c=p.encodedMaskData;m=p.maskData;g.width=p.width;g.height=p.height;g.dimCount=p.dimCount||1;g.pixelType=p.pixelType||p.fileInfo.pixelType;g.mask=p.maskData}u>1&&p.fileInfo.mask&&p.fileInfo.mask.numBytes>0&&h.push(p.maskData);o++;g.pixels.push(p.pixelData);g.statistics.push({minValue:p.minValue,maxValue:p.maxValue,noDataValue:p.noDataValue,dimStats:p.dimStats})}var w,k,x;if(u>1&&h.length>1){x=g.width*g.height;g.bandMasks=h;m=new Uint8Array(x);m.set(h[0]);for(w=1;w<h.length;w++){d=h[w];for(k=0;k<x;k++)m[k]=m[k]&d[k]}g.maskData=m}return g}};r?r=n:(this||e).Lerc=n})();var a=r;export default a;

