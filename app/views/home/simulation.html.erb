<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>NASA Asteroid Impact Decision Support System</title>
  <style>
    :root { 
      --panel:#1a1428; 
      --panel-light:#2d2344;
      --ink:#f0f0f0; 
      --lav:#b39ddb; 
      --border:#93b4d8; 
      --severe:#ff1744;
      --critical:#ff4d4f;
      --major:#ff6b35;
      --moderate:#ffa940; 
      --minor:#ffd666;
      --safe:#4caf50;
      --ocean:#1565c0;
      --tsunami:#00acc1;
      --ejecta:#ff9800;
      --thermal:#ff5722;
      --seismic:#9c27b0;
    }
    
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    html,body{
      height:100%;
      background:linear-gradient(135deg, #0a0e1a 0%, #1a0f2e 50%, #0f1823 100%);
      color:var(--ink);
      font-family:'Inter',system-ui,-apple-system,sans-serif;
      overflow:hidden;
      position:relative;
    }
    
    #main-frame{
      position:relative;
      height:100%;
      display:flex;
      flex-direction:column;
    }
    
    .header{
      position:absolute;
      top:0;
      left:0;
      right:0;
      background:linear-gradient(180deg, rgba(26,20,40,0.95) 0%, rgba(26,20,40,0.85) 50%, transparent 100%);
      backdrop-filter:blur(10px);
      padding:1rem 2rem;
      z-index:100;
      border-bottom:1px solid rgba(147,180,216,0.2);
    }
    
    .header-content{
      display:flex;
      align-items:center;
      justify-content:space-between;
      max-width:1600px;
      margin:0 auto;
    }
    
    .logo-section{
      display:flex;
      align-items:center;
      gap:1rem;
    }
    
    .logo{
      width:40px;
      height:40px;
      background:linear-gradient(135deg, var(--critical) 0%, var(--major) 100%);
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:bold;
      font-size:1.2rem;
      box-shadow:0 0 20px rgba(255,77,79,0.4);
    }
    
    .app-title{
      font-size:1.3rem;
      font-weight:700;
      background:linear-gradient(135deg, var(--lav) 0%, var(--border) 100%);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
      letter-spacing:-0.02em;
    }
    
    .status-bar{
      display:flex;
      gap:1.5rem;
      align-items:center;
      font-size:0.85rem;
    }
    
    .status-item{
      display:flex;
      align-items:center;
      gap:0.5rem;
      padding:0.4rem 0.8rem;
      background:rgba(45,35,68,0.5);
      border:1px solid rgba(147,180,216,0.2);
      border-radius:20px;
    }
    
    .status-indicator{
      width:8px;
      height:8px;
      border-radius:50%;
      background:var(--safe);
      animation:pulse 2s ease-in-out infinite;
    }
    
    @keyframes pulse {
      0%,100% { opacity:1; transform:scale(1); }
      50% { opacity:0.7; transform:scale(1.2); }
    }
    
    .main-container{
      display:flex;
      height:100%;
      position:relative;
    }
    
    .sidebar{
      position:absolute;
      top:80px;
      left:20px;
      width:380px;
      max-height:calc(100vh - 100px);
      z-index:50;
      display:flex;
      flex-direction:column;
      gap:1rem;
      overflow-y:auto;
      scrollbar-width:thin;
      scrollbar-color:var(--border) transparent;
    }
    
    .panel{
      background:linear-gradient(180deg, rgba(26,20,40,0.95) 0%, rgba(29,21,48,0.9) 100%);
      backdrop-filter:blur(20px);
      border:1px solid rgba(147,180,216,0.25);
      border-radius:16px;
      box-shadow:0 20px 40px rgba(0,0,0,0.5);
      padding:1.2rem;
      animation:slideIn 0.4s ease-out;
    }
    
    @keyframes slideIn {
      from { opacity:0; transform:translateX(-20px); }
      to { opacity:1; transform:translateX(0); }
    }
    
    .panel-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:1rem;
      padding-bottom:0.8rem;
      border-bottom:1px solid rgba(147,180,216,0.15);
    }
    
    .panel-title{
      color:var(--lav);
      font-size:1rem;
      font-weight:600;
      letter-spacing:0.5px;
      text-transform:uppercase;
    }
    
    .panel-badge{
      background:rgba(147,180,216,0.2);
      color:var(--border);
      padding:0.2rem 0.6rem;
      border-radius:12px;
      font-size:0.75rem;
      font-weight:600;
    }
    
    .form-group{
      display:grid;
      grid-template-columns:140px 1fr;
      gap:0.8rem;
      align-items:center;
      margin:0.8rem 0;
    }
    
    label{
      font-size:0.85rem;
      color:#cfd6ff;
      font-weight:500;
    }
    
    .input-wrapper{
      position:relative;
      display:flex;
      align-items:center;
    }
    
    input[type="number"],
    select{
      width:100%;
      padding:0.5rem 0.8rem;
      border-radius:10px;
      border:1px solid rgba(79,74,115,0.5);
      background:rgba(19,16,39,0.8);
      color:#e9ecff;
      font-size:0.9rem;
      transition:all 0.2s ease;
    }
    
    input[type="number"]:focus,
    select:focus{
      outline:none;
      border-color:var(--border);
      background:rgba(19,16,39,1);
      box-shadow:0 0 0 3px rgba(147,180,216,0.1);
    }
    
    .input-unit{
      position:absolute;
      right:10px;
      color:rgba(207,214,255,0.5);
      font-size:0.8rem;
      pointer-events:none;
    }
    
    .btn-group{
      display:flex;
      gap:0.8rem;
      margin-top:1.2rem;
    }
    
    .btn{
      flex:1;
      cursor:pointer;
      padding:0.7rem 1rem;
      border-radius:12px;
      border:none;
      font-weight:600;
      font-size:0.9rem;
      transition:all 0.2s ease;
      text-transform:uppercase;
      letter-spacing:0.5px;
    }
    
    .btn-primary{
      background:linear-gradient(135deg, var(--border) 0%, var(--lav) 100%);
      color:#171226;
      box-shadow:0 4px 15px rgba(147,180,216,0.3);
    }
    
    .btn-primary:hover{
      transform:translateY(-2px);
      box-shadow:0 6px 20px rgba(147,180,216,0.4);
    }
    
    .btn-secondary{
      background:rgba(43,34,70,0.8);
      color:#d9dcff;
      border:1px solid rgba(61,52,96,0.5);
    }
    
    .btn-secondary:hover{
      background:rgba(43,34,70,1);
      border-color:rgba(147,180,216,0.3);
    }
    
    .metrics-panel{
      max-height:400px;
      overflow-y:auto;
    }
    
    .metric-group{
      margin:1rem 0;
      padding:0.8rem;
      background:rgba(19,16,39,0.4);
      border-radius:12px;
      border:1px solid rgba(79,74,115,0.3);
    }
    
    .metric-group-title{
      font-size:0.9rem;
      font-weight:600;
      color:var(--lav);
      margin-bottom:0.6rem;
      text-transform:uppercase;
      letter-spacing:0.5px;
    }
    
    .metric-item{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin:0.5rem 0;
      padding:0.4rem 0;
      border-bottom:1px solid rgba(79,74,115,0.2);
    }
    
    .metric-item:last-child{
      border-bottom:none;
    }
    
    .metric-label{
      font-size:0.85rem;
      color:rgba(207,214,255,0.8);
    }
    
    .metric-value{
      font-size:0.95rem;
      font-weight:600;
      color:#fff;
    }
    
    .metric-value.critical{ color:var(--critical); }
    .metric-value.severe{ color:var(--severe); }
    .metric-value.major{ color:var(--major); }
    .metric-value.moderate{ color:var(--moderate); }
    .metric-value.minor{ color:var(--minor); }
    .metric-value.safe{ color:var(--safe); }
    
    .damage-grid{
      display:grid;
      grid-template-columns:repeat(2, 1fr);
      gap:0.8rem;
      margin-top:0.8rem;
    }
    
    .damage-card{
      background:rgba(19,16,39,0.6);
      border:1px solid rgba(79,74,115,0.3);
      border-radius:10px;
      padding:0.8rem;
      text-align:center;
    }
    
    .damage-icon{
      font-size:1.5rem;
      margin-bottom:0.3rem;
    }
    
    .damage-label{
      font-size:0.75rem;
      color:rgba(207,214,255,0.7);
      margin-bottom:0.2rem;
    }
    
    .damage-value{
      font-size:0.9rem;
      font-weight:600;
    }
    
    .legend{
      display:flex;
      flex-wrap:wrap;
      gap:0.8rem;
      margin-top:0.8rem;
      padding:0.8rem;
      background:rgba(19,16,39,0.3);
      border-radius:10px;
    }
    
    .legend-item{
      display:flex;
      align-items:center;
      gap:0.5rem;
      font-size:0.8rem;
    }
    
    .legend-color{
      width:14px;
      height:14px;
      border-radius:50%;
      border:2px solid rgba(255,255,255,0.2);
    }
    
    .globe-container{
      position:fixed;
      inset:0;
      z-index:1;
    }
    
    .tooltip{
      position:fixed;
      pointer-events:none;
      background:rgba(20,18,42,0.95);
      color:#fff;
      border:1px solid rgba(62,58,99,0.5);
      padding:0.6rem 0.8rem;
      border-radius:8px;
      font-size:0.85rem;
      box-shadow:0 4px 20px rgba(0,0,0,0.4);
      opacity:0;
      transition:opacity 0.2s;
      backdrop-filter:blur(10px);
      max-width:250px;
      z-index:100;
    }
    
    .tooltip-title{
      font-weight:600;
      margin-bottom:0.3rem;
      color:var(--lav);
    }
    
    .tooltip-content{
      line-height:1.4;
    }
    
    .timeline-bar{
      position:absolute;
      bottom:20px;
      left:50%;
      transform:translateX(-50%);
      width:600px;
      background:rgba(26,20,40,0.9);
      backdrop-filter:blur(10px);
      border:1px solid rgba(147,180,216,0.25);
      border-radius:16px;
      padding:1rem;
      z-index:50;
    }
    
    .timeline-controls{
      display:flex;
      align-items:center;
      gap:1rem;
    }
    
    .timeline-slider{
      flex:1;
      height:6px;
      background:rgba(79,74,115,0.5);
      border-radius:3px;
      position:relative;
      cursor:pointer;
    }
    
    .timeline-progress{
      position:absolute;
      height:100%;
      background:linear-gradient(90deg, var(--border) 0%, var(--lav) 100%);
      border-radius:3px;
      width:0%;
      transition:width 0.1s linear;
    }
    
    .timeline-handle{
      position:absolute;
      width:16px;
      height:16px;
      background:#fff;
      border:3px solid var(--lav);
      border-radius:50%;
      top:50%;
      transform:translate(-50%, -50%);
      cursor:grab;
      box-shadow:0 2px 8px rgba(0,0,0,0.3);
    }
    
    .timeline-time{
      font-size:0.9rem;
      font-weight:600;
      color:var(--lav);
      min-width:80px;
      text-align:center;
    }
    
    .play-btn{
      width:36px;
      height:36px;
      border-radius:50%;
      background:var(--lav);
      border:none;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      color:#171226;
      font-size:1rem;
      transition:all 0.2s;
    }
    
    .play-btn:hover{
      transform:scale(1.1);
      box-shadow:0 4px 15px rgba(179,157,219,0.4);
    }
    
    /* Globe specific styling */
    .sphere{fill:url(#oceanGrad)}
    .land{fill:#2a4d7f;cursor:pointer;transition:fill 0.2s}
    .land:hover{fill:#3a6da0}
    .boundary{fill:none;stroke:#5a8dc9;stroke-width:0.5;opacity:0.6}
    .graticule{fill:none;stroke:#2a4d7f;stroke-width:0.5;opacity:0.3}
    
    .ring-severe{fill:none;stroke:var(--severe);stroke-width:2.5;opacity:0.9}
    .ring-critical{fill:none;stroke:var(--critical);stroke-width:2.5;opacity:0.9}
    .ring-major{fill:none;stroke:var(--major);stroke-width:2;opacity:0.8}
    .ring-moderate{fill:none;stroke:var(--moderate);stroke-width:2;opacity:0.7}
    .ring-minor{fill:none;stroke:var(--minor);stroke-width:1.5;opacity:0.6}
    .ring-thermal{fill:none;stroke:var(--thermal);stroke-width:2;opacity:0.7;stroke-dasharray:5,3}
    .ring-seismic{fill:none;stroke:var(--seismic);stroke-width:1.5;opacity:0.6;stroke-dasharray:3,2}
    .ring-ejecta{fill:none;stroke:var(--ejecta);stroke-width:2;opacity:0.5}
    .ring-tsunami{fill:none;stroke:var(--tsunami);stroke-width:3;opacity:0.6;stroke-dasharray:8,4}
    
    .impact-point{fill:var(--critical);stroke:#fff;stroke-width:2;filter:drop-shadow(0 0 10px var(--critical))}
    .entry-trajectory{fill:none;stroke:url(#trajectoryGrad);stroke-width:3;stroke-linecap:round;opacity:0.9}
    .debris-path{fill:none;stroke:var(--ejecta);stroke-width:1;opacity:0.4;stroke-dasharray:2,3}
    
    .shockwave{
      fill:none;
      stroke:var(--critical);
      stroke-width:2;
      opacity:0;
      animation:shockwave 2s ease-out infinite;
    }
    
    @keyframes shockwave {
      0% { r:0; opacity:1; stroke-width:4; }
      100% { r:100; opacity:0; stroke-width:0.5; }
    }
    
    @media(max-width:1024px){
      .sidebar{ width:340px; }
      .timeline-bar{ width:90%; max-width:500px; }
    }
    
    @media(max-width:768px){
      .sidebar{ 
        width:calc(100vw - 40px);
        max-height:50vh;
        bottom:20px;
        top:auto;
      }
      .header-content{ flex-direction:column; gap:1rem; }
      .timeline-bar{ display:none; }
    }
  </style>
</head>
<body>
  <div id="main-frame"
       data-controller="impact"
       data-impact-countries-url-value="<%= asset_path('countries-110m.json') %>">
    
    <header class="header">
      <div class="header-content">
        <div class="logo-section">
          <div class="logo">üåç</div>
          <h1 class="app-title">NASA Asteroid Impact Decision Support System</h1>
        </div>
        <div class="status-bar">
          <div class="status-item">
            <span class="status-indicator"></span>
            <span>System Ready</span>
          </div>
          <div class="status-item">
            <span>Simulation Mode</span>
          </div>
          <div class="status-item" data-impact-target="simCount">
            <span>0 Simulations</span>
          </div>
        </div>
      </div>
    </header>

    <div class="main-container">
      <aside class="sidebar">
        <!-- Input Panel -->
        <div class="panel">
          <div class="panel-header">
            <h2 class="panel-title">Impact Parameters</h2>
            <span class="panel-badge">Physics Engine v2.0</span>
          </div>
          
          <form data-impact-target="form" data-action="submit->impact#simulate">
            <!-- Object Properties -->
            <div class="form-group">
              <label for="neo_select">NEO Object</label>
              <select id="neo_select" name="neo_id" data-action="change->impact#loadNEO">
                <option value="">Custom Parameters</option>
                <option value="recent">Recent Close Approach</option>
                <option value="hazardous">Potentially Hazardous</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="diameter_m">Diameter</label>
              <div class="input-wrapper">
                <input id="diameter_m" name="diameter_m" type="number" min="10" max="20000" step="10" value="500" />
                <span class="input-unit">m</span>
              </div>
            </div>
            
            <div class="form-group">
              <label for="density_kg_m3">Density</label>
              <div class="input-wrapper">
                <input id="density_kg_m3" name="density_kg_m3" type="number" min="500" max="8000" step="50" value="3500" />
                <span class="input-unit">kg/m¬≥</span>
              </div>
            </div>
            
            <div class="form-group">
              <label for="velocity_kms">Velocity</label>
              <div class="input-wrapper">
                <input id="velocity_kms" name="velocity_kms" type="number" min="5" max="72" step="0.1" value="25" />
                <span class="input-unit">km/s</span>
              </div>
            </div>
            
            <div class="form-group">
              <label for="impact_angle_deg">Impact Angle</label>
              <div class="input-wrapper">
                <input id="impact_angle_deg" name="impact_angle_deg" type="number" min="5" max="90" step="1" value="45" />
                <span class="input-unit">¬∞</span>
              </div>
            </div>
            
            <div class="form-group">
              <label for="strength_mpa">Material Strength</label>
              <div class="input-wrapper">
                <input id="strength_mpa" name="strength_mpa" type="number" min="0.1" max="100" step="0.1" value="10" />
                <span class="input-unit">MPa</span>
              </div>
            </div>
            
            <div class="form-group">
              <label for="azimuth_deg">Approach Azimuth</label>
              <div class="input-wrapper">
                <input id="azimuth_deg" name="azimuth_deg" type="number" min="0" max="359.9" step="0.1" value="45" />
                <span class="input-unit">¬∞ from N</span>
              </div>
            </div>
            
            <!-- Impact Location -->
            <div class="form-group">
              <label for="lat">Latitude</label>
              <input id="lat" name="lat" type="number" min="-90" max="90" step="0.0001" value="10.0000" />
            </div>
            
            <div class="form-group">
              <label for="lng">Longitude</label>
              <input id="lng" name="lng" type="number" min="-180" max="180" step="0.0001" value="-84.0000" />
            </div>
            
            <!-- Mitigation Options -->
            <div class="form-group">
              <label for="mitigation">Mitigation</label>
              <select id="mitigation" name="mitigation_type">
                <option value="none">No Mitigation</option>
                <option value="deflection">Kinetic Deflection</option>
                <option value="ablation">Laser Ablation</option>
                <option value="nuclear">Nuclear Device</option>
              </select>
            </div>
            
            <div class="btn-group">
              <button type="button" class="btn btn-secondary" data-action="impact#resetView">Reset View</button>
              <button type="submit" class="btn btn-primary">Run Simulation</button>
            </div>
          </form>
        </div>

        <!-- Results Panel -->
        <div class="panel metrics-panel">
          <div class="panel-header">
            <h2 class="panel-title">Impact Analysis</h2>
            <span class="panel-badge" data-impact-target="threatLevel">Awaiting</span>
          </div>
          
          <div data-impact-target="metrics">
            <div class="metric-group">
              <div class="metric-group-title">Primary Effects</div>
              <div class="metric-item">
                <span class="metric-label">Impact Mode</span>
                <span class="metric-value">‚Äî</span>
              </div>
              <div class="metric-item">
                <span class="metric-label">Energy Released</span>
                <span class="metric-value">‚Äî</span>
              </div>
              <div class="metric-item">
                <span class="metric-label">Crater Diameter</span>
                <span class="metric-value">‚Äî</span>
              </div>
            </div>
            
            <div class="metric-group">
              <div class="metric-group-title">Damage Zones</div>
              <div class="damage-grid">
                <div class="damage-card">
                  <div class="damage-icon">üí•</div>
                  <div class="damage-label">Vaporization</div>
                  <div class="damage-value">‚Äî</div>
                </div>
                <div class="damage-card">
                  <div class="damage-icon">üî•</div>
                  <div class="damage-label">Thermal</div>
                  <div class="damage-value">‚Äî</div>
                </div>
                <div class="damage-card">
                  <div class="damage-icon">üí®</div>
                  <div class="damage-label">Blast</div>
                  <div class="damage-value">‚Äî</div>
                </div>
                <div class="damage-card">
                  <div class="damage-icon">üåä</div>
                  <div class="damage-label">Tsunami</div>
                  <div class="damage-value">‚Äî</div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="legend">
            <div class="legend-item">
              <span class="legend-color" style="background:var(--critical)"></span>
              <span>Total Destruction</span>
            </div>
            <div class="legend-item">
              <span class="legend-color" style="background:var(--severe)"></span>
              <span>Severe Damage</span>
            </div>
            <div class="legend-item">
              <span class="legend-color" style="background:var(--major)"></span>
              <span>Major Damage</span>
            </div>
            <div class="legend-item">
              <span class="legend-color" style="background:var(--moderate)"></span>
              <span>Moderate</span>
            </div>
            <div class="legend-item">
              <span class="legend-color" style="background:var(--thermal)"></span>
              <span>Thermal</span>
            </div>
            <div class="legend-item">
              <span class="legend-color" style="background:var(--tsunami)"></span>
              <span>Tsunami</span>
            </div>
          </div>
        </div>
      </aside>

      <!-- Globe Container -->
      <div class="globe-container" data-impact-target="globe"></div>


      
      <!-- Timeline Bar -->
      <div class="timeline-bar" data-impact-target="timeline" style="display:none;">
        <div class="timeline-controls">
          <button class="play-btn" data-action="impact#togglePlayback">‚ñ∂</button>
          <span class="timeline-time">T-00:00</span>
          <div class="timeline-slider">
            <div class="timeline-progress"></div>
            <div class="timeline-handle" style="left:0%"></div>
          </div>
          <span class="timeline-time">Impact</span>
        </div>
      </div>
      
      <!-- Enhanced Tooltip -->
      <div class="tooltip" data-impact-target="tooltip">
        <div class="tooltip-title"></div>
        <div class="tooltip-content"></div>
      </div>
    </div>
  </div>
</body>
</html>