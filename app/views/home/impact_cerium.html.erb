  <%= render "layouts/navbar" %>
  <%= render "layouts/right_sidebar" %>

<div id="main-frame"
      data-controller="cesium-impact neo-browser"
      data-cesium-impact-world-url-value="<%= asset_path('countries-110m.json') %>"
      data-cesium-impact-mercury-url-value="<%= asset_path('mercury.jpg') %>"
      data-cesium-impact-venus-url-value="<%= asset_path('venus.jpg') %>"
      data-cesium-impact-earth-url-value="<%= asset_path('earth.jpg') %>"
      data-cesium-impact-mars-url-value="<%= asset_path('mars.jpg') %>"
      data-cesium-impact-jupiter-url-value="<%= asset_path('jupiter.jpg') %>"
      data-cesium-impact-saturn-url-value="<%= asset_path('saturn.jpg') %>"
      data-cesium-impact-saturn-ring-url-value="<%= asset_path('saturn_ring.png') %>"
      data-cesium-impact-uranus-url-value="<%= asset_path('uranus.jpg') %>"
      data-cesium-impact-neptune-url-value="<%= asset_path('neptune.jpg') %>"
      data-cesium-impact-sun-url-value="<%= asset_path('sun.jpg') %>"
      data-cesium-impact-stars-url-value="<%= asset_path('stars.jpg') %>"
      data-cesium-impact-milky-url-value="<%= asset_path('milky.jpg') %>"
      data-cesium-impact-earth-day-url-value="<%= asset_path('earth_day.jpg') %>"
      data-cesium-impact-earth-night-url-value="<%= asset_path('earth_night.jpg') %>"
      data-cesium-impact-earth-clouds-url-value="<%= asset_path('earth_clouds.jpg') %>"
      data-cesium-impact-earth-normal-url-value="<%= asset_path('earth_normal.jpg') %>"
      data-cesium-impact-earth-spec-url-value="<%= asset_path('earth_spec.jpg') %>">

  <!-- Loading Screen -->
  <div class="loading-overlay" data-cesium-impact-target="loadingOverlay">
    <div class="loading-content">
      <div class="loading-spinner">
        <div class="orbit-ring"></div>
        <div class="orbit-ring"></div>
        <div class="orbit-ring"></div>
        <div class="planet-dot"></div>
      </div>
      <h2 class="loading-title" data-cesium-impact-target="loadingTitle">Initializing Solar System</h2>
      <p class="loading-subtitle" data-cesium-impact-target="loadingSubtitle">Loading planetary textures and orbital data...</p>
      <div class="loading-progress">
        <div class="progress-bar" data-cesium-impact-target="progressBar"></div>
      </div>
      <div class="loading-tips">
        <p data-cesium-impact-target="loadingTip">💡 Tip: Click on Earth to set impact location</p>
      </div>
    </div>
  </div>

  <!-- Cesium Container -->
  <div id="cesiumContainer" data-cesium-impact-target="cesiumContainer"></div>

  <!-- NEO Browser Modal (Outside Form) -->
  <div class="neo-browser-modal"
        data-neo-browser-target="modal"
        style="display: none;">
    <div class="neo-browser-content">
      <div class="neo-browser-header">
        <h3>Search Near-Earth Objects</h3>
        <button type="button"
                class="close-btn"
                data-action="click->neo-browser#close"
                title="Close (ESC)">✕</button>
      </div>

      <!-- Search Controls -->
      <div class="neo-search-controls">
        <div class="search-header">
          <h4>Search by Close Approach Date</h4>
          <p class="search-help">Find NEOs approaching Earth within a specific date range</p>
        </div>

        <!-- Date Search Controls -->
        <div class="date-search-controls">
          <div class="date-inputs">
            <div class="date-input-group">
              <label>Start Date</label>
              <input type="date"
                      data-neo-browser-target="startDate"
                      data-action="keydown.enter->neo-browser#searchByDate"
                      value="<%= Date.today.to_s %>"
                      max="<%= (Date.today + 7.days).to_s %>">
            </div>
            <div class="date-input-group">
              <label>End Date</label>
              <input type="date"
                      data-neo-browser-target="endDate"
                      data-action="keydown.enter->neo-browser#searchByDate"
                      value="<%= (Date.today + 6.days).to_s %>"
                      max="<%= (Date.today + 7.days).to_s %>">
            </div>
          </div>
          <button type="button"
                  class="btn btn-primary search-btn"
                  data-action="click->neo-browser#searchByDate"
                  data-neo-browser-target="searchButton">
            <span class="search-icon">🔍</span>
            Search NEOs
          </button>
        </div>
      </div>

      <!-- Results Container -->
      <%= turbo_frame_tag "neo_results" do %>
        <div class="neo-initial-state">
          <div class="initial-icon">🌌</div>
          <p class="initial-message">Ready to explore Near-Earth Objects</p>
          <p class="initial-submessage">Select a date range to find approaching asteroids</p>
          <div class="quick-tips">
            <span class="tip">💡 Tip: Search up to 7 days of close approaches</span>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <%= render "layouts/sidebar" %>

  <!-- Timeline Controls -->
  <div class="timeline-bar" style="display:none" data-cesium-impact-target="timeline">
    <div class="timeline-controls">
      <button class="play-btn"
              data-action="click->cesium-impact#togglePlayback"
              data-cesium-impact-target="playBtn">▶</button>

      <div class="timeline-time" data-cesium-impact-target="timeStart">T-0:00</div>

      <div class="timeline-slider">
        <div class="timeline-progress" data-cesium-impact-target="timelineProgress"></div>
        <div class="timeline-handle" data-cesium-impact-target="timelineHandle" style="left:0%"></div>
      </div>

      <div class="timeline-time" data-cesium-impact-target="timeEnd">Impact</div>
    </div>
  </div>
</div>
